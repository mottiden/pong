"use strict";function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Vec=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck(this,t),this.x=e,this.y=n}return _createClass(t,[{key:"len",get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},set:function(t){var e=t/this.len;this.x*=e,this.y*=e}}]),t}(),Rect=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck(this,t),this.pos=new Vec(0,0),this.size=new Vec(e,n)}return _createClass(t,[{key:"left",get:function(){return this.pos.x-this.size.x/2}},{key:"right",get:function(){return this.pos.x+this.size.x/2}},{key:"top",get:function(){return this.pos.y-this.size.y/2}},{key:"bottom",get:function(){return this.pos.y+this.size.y/2}}]),t}(),Ball=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,10,10));return t.vel=new Vec,t}return _inherits(e,t),e}(Rect),Player=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,20,100));return t.vel=new Vec,t.score=0,t._lastPos=new Vec,t}return _inherits(e,t),_createClass(e,[{key:"update",value:function(t){this.vel.y=(this.pos.y-this._lastPos.y)/t,this._lastPos.y=this.pos.y}}]),e}(Rect),Pong=function(){function t(e){var n=this;_classCallCheck(this,t),this._canvas=e,this._context=e.getContext("2d"),this.initialSpeed=250,this.ball=new Ball,this.players=[new Player,new Player],this.players[0].pos.x=40,this.players[1].pos.x=this._canvas.width-40,this.players.forEach(function(t){return t.pos.y=n._canvas.height/2});var i=null;this._frameCallback=function(t){if(null!==i){var e=t-i;n.update(e/1e3)}i=t,requestAnimationFrame(n._frameCallback)},this.CHAR_PIXEL=10,this.CHARS=["111101101101111","010010010010010","111001111100111","111001111001111","101101111001001","111100111001111","111100111101111","111001001001001","111101111101111","111101111001111"].map(function(t){var e=document.createElement("canvas"),i=n.CHAR_PIXEL;e.height=5*i,e.width=3*i;var s=e.getContext("2d");return s.fillStyle="#fff",t.split("").forEach(function(t,e){"1"===t&&s.fillRect(e%3*i,(e/3|0)*i,i,i)}),e}),this.reset()}return _createClass(t,[{key:"clear",value:function(){this._context.fillStyle="#000",this._context.fillRect(0,0,this._canvas.width,this._canvas.height)}},{key:"collide",value:function(t,e){if(t.left<e.right&&t.right>e.left&&t.top<e.bottom&&t.bottom>e.top){e.vel.x=1.05*-e.vel.x;var n=e.vel.len;e.vel.y+=.2*t.vel.y,e.vel.len=n}}},{key:"draw",value:function(){var t=this;this.clear(),this.drawRect(this.ball),this.players.forEach(function(e){return t.drawRect(e)}),this.drawScore()}},{key:"drawRect",value:function(t){this._context.fillStyle="#fff",this._context.fillRect(t.left,t.top,t.size.x,t.size.y)}},{key:"drawScore",value:function(){var t=this,e=this._canvas.width/3,n=4*this.CHAR_PIXEL;this.players.forEach(function(i,s){var a=i.score.toString().split(""),r=e*(s+1)-n*a.length/2+t.CHAR_PIXEL/2;a.forEach(function(e,i){t._context.drawImage(t.CHARS[0|e],r+i*n,20)})})}},{key:"play",value:function(){var t=this.ball;0===t.vel.x&&0===t.vel.y&&(t.vel.x=200*(Math.random()>.5?1:-1),t.vel.y=200*(2*Math.random()-1),t.vel.len=this.initialSpeed)}},{key:"reset",value:function(){var t=this.ball;t.vel.x=0,t.vel.y=0,t.pos.x=this._canvas.width/2,t.pos.y=this._canvas.height/2}},{key:"start",value:function(){requestAnimationFrame(this._frameCallback)}},{key:"update",value:function(t){var e=this,n=this._canvas,i=this.ball;i.pos.x+=i.vel.x*t,i.pos.y+=i.vel.y*t,(i.right<0||i.left>n.width)&&(++this.players[i.vel.x<0|0].score,this.reset()),(i.vel.y<0&&i.top<0||i.vel.y>0&&i.bottom>n.height)&&(i.vel.y=-i.vel.y),this.players[1].pos.y=i.pos.y,this.players.forEach(function(n){n.update(t),e.collide(n,i)}),this.draw()}}]),t}(),canvas=document.querySelector("#pong"),pong=new Pong(canvas);canvas.addEventListener("click",function(){return pong.play()}),canvas.addEventListener("mousemove",function(t){var e=t.offsetY/t.target.getBoundingClientRect().height;pong.players[0].pos.y=canvas.height*e}),pong.start();